# Linux Audit Daemon - Log collection Rules
#
# U _____ u _   _     _____  U _____ u   ____      ____      ____                ____   U _____ u         _       _   _   ____              _____   ____    
# \| ___"|/| \ |"|   |_ " _| \| ___"|/U |  _"\ u U|  _"\ uU |  _"\ u     ___    / __"| u\| ___"|/     U  /"\  uU |"|u| | |  _"\    ___     |_ " _| |  _"\   
#  |  _|" <|  \| |>    | |    |  _|"   \| |_) |/ \| |_) |/ \| |_) |/    |_"_|  <\___ \/  |  _|" U  u   \/ _ \/  \| |\| |/| | | |  |_"_|      | |  /| | | |  
#  | |___ U| |\  |u   /| |\   | |___    |  _ <    |  __/    |  _ <       | |    u___) |  | |___ /___\  / ___ \   | |_| |U| |_| |\  | |      /| |\ U| |_| |\ 
#  |_____| |_| \_|   u |_|U   |_____|   |_| \_\   |_|       |_| \_\    U/| |\u  |____/>> |_____|__"__|/_/   \_\ <<\___/  |____/ uU/| |\u   u |_|U  |____/ u 
#  <<   >> ||   \\,-._// \\_  <<   >>   //   \\_  ||>>_     //   \\_.-,_|___|_,-.)(  (__)<<   >>       \\    >>(__) )(    |||_.-,_|___|_,-._// \\_  |||_    
# (__) (__)(_")  (_/(__) (__)(__) (__) (__)  (__)(__)__)   (__)  (__)\_)-' '-(_/(__)    (__) (__)     (__)  (__)   (__)  (__)_)\_)-' '-(_/(__) (__)(__)_)   
#                                                                                                                Â© Speranza Ranieri (sranieri@unisa.it)
#

# Unsuccessful permission change (EACCES/EPERM)
-a always,exit -F arch=b32 -S chmod,fchmod,fchmodat,setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F exit=-EACCES -F auid>=1000 -F auid!=unset -k unsuccessful_perm_change
-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat,setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F exit=-EACCES -F auid>=1000 -F auid!=unset -k unsuccessful_perm_change
-a always,exit -F arch=b32 -S chmod,fchmod,fchmodat,setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F exit=-EPERM  -F auid>=1000 -F auid!=unset -k unsuccessful_perm_change
-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat,setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F exit=-EPERM  -F auid>=1000 -F auid!=unset -k unsuccessful_perm_change

# Successful permission change
-a always,exit -F arch=b32 -S chmod,fchmod,fchmodat,setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F success=1 -F auid>=1000 -F auid!=unset -k successful_perm_change
-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat,setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F success=1 -F auid>=1000 -F auid!=unset -k successful_perm_change

# Unsuccessful ownership change (EACCES/EPERM)
-a always,exit -F arch=b32 -S chown,fchown,lchown,fchownat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k unsuccessful_owner_change
-a always,exit -F arch=b64 -S chown,fchown,lchown,fchownat -F exit=-EACCES -F auid>=1000 -F auid!=unset -k unsuccessful_owner_change
-a always,exit -F arch=b32 -S chown,fchown,lchown,fchownat -F exit=-EPERM  -F auid>=1000 -F auid!=unset -k unsuccessful_owner_change
-a always,exit -F arch=b64 -S chown,fchown,lchown,fchownat -F exit=-EPERM  -F auid>=1000 -F auid!=unset -k unsuccessful_owner_change

# Successful ownership change
-a always,exit -F arch=b32 -S chown,fchown,lchown,fchownat -F success=1 -F auid>=1000 -F auid!=unset -k successful_owner_change
-a always,exit -F arch=b64 -S chown,fchown,lchown,fchownat -F success=1 -F auid>=1000 -F auid!=unset -k successful_owner_change